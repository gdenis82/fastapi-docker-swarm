# Локальная разработка

Для локальной разработки используется Docker Compose, который запускает все необходимые сервисы: бэкенд, фронтенд, базу данных PostgreSQL, Redis и Adminer.

## Предварительные требования

- Docker и Docker Compose

## Быстрый запуск

### Использование Makefile (рекомендуется)

Если у вас установлен `make`, вы можете использовать следующие команды:

1. Склонируйте репозиторий.
2. Запустите проект:
   ```bash
   make up
   ```
3. Посмотреть доступные команды:
   ```bash
   make help
   ```

### Использование Docker Compose напрямую

Если `make` не установлен:

1. Склонируйте репозиторий.
2. Из корня проекта выполните команду:
   ```bash
   docker-compose -f docker-compose.dev.yml up --build
   ```
3. После запуска сервисы будут доступны по следующим адресам:
   - **Frontend**: [http://localhost:3000](http://localhost:3000)
   - **Backend API**: [http://localhost:8000/api](http://localhost:8000/api)
   - **Документация API (Swagger)**: [http://localhost:8000/api/docs](http://localhost:8000/api/docs)
   - **Adminer (управление БД)**: [http://localhost:8089](http://localhost:8089) (используйте сервер `db`, логин/пароль `postgres/postgres`)

## Особенности локальной конфигурации

- **Горячая перезагрузка (Hot Reload)**:
  - Код бэкенда (`services/backend`) и фронтенда (`services/frontend`) проброшен в контейнеры через `volumes`. При изменении файлов на вашей машине сервисы автоматически перезапустятся.
- **База данных и Redis**:
  - Данные БД и Redis в этой конфигурации не сохраняются в постоянных томах (volumes) за пределами жизненного цикла контейнеров, если вы их не добавили. Для разработки это удобно, чтобы всегда иметь "чистую" базу при пересборке.
- **Взаимодействие компонентов**:
  - Фронтенд обращается к бэкенду через `NEXT_PUBLIC_API_URL=http://localhost:8000/api` (из браузера).
  - Бэкенд подключается к БД и Redis, используя имена сервисов из `docker-compose.dev.yml` (`db` и `redis`).

## Запуск бэкенда без Docker

Если вы хотите запустить только бэкенд локально (например, для отладки), следуйте этим шагам:

### 1. Подготовка базы данных и Redis
Бэкенду по-прежнему нужны БД и Redis (frontend если нужен). Проще всего запустить их через Docker:
```bash
docker-compose -f docker-compose.dev.yml up -d db redis frontend
```

### 2. Настройка окружения Python

Рекомендуется использовать `uv` для управления зависимостями и запуска проекта.

**Вариант А: Использование uv (рекомендуется)**
Если у вас установлен `uv`, просто запустите:
```bash
make run-backend
```
Или вручную из директории бэкенда:
```bash
cd services/backend
uv run --active uvicorn app.main:app --reload
```
`uv` автоматически создаст окружение и установит зависимости.

**Вариант Б: Традиционный способ с venv**
Перейдите в директорию бэкенда:
```bash
cd services/backend
```

Создайте виртуальное окружение:
```bash
python -m venv .venv
# Активация на Windows:
.\.venv\Scripts\activate
# Активация на Linux/macOS:
source .venv/bin/activate
```

Установите зависимости:
```bash
pip install -r requirements.txt
```

После этого вы можете запускать бэкенд командой `make run-backend` из корня проекта — она обнаружит локальное окружение в `services/backend/.venv`.

### 3. Переменные окружения
В директории `services/backend` уже должен быть файл `.env`. Убедитесь, что там указаны правильные параметры подключения (по умолчанию для localhost).

### 4. Запуск бэкенда
Если вы не используете `make` или `uv run`, запустите uvicorn напрямую (после активации venv):
```bash
uvicorn app.main:app --reload
```
Бэкенд будет доступен по адресу [http://localhost:8000](http://localhost:8000).

## Полезные команды

- **Остановка всех сервисов**:
  ```bash
  docker-compose -f docker-compose.dev.yml down
  ```
- **Просмотр логов конкретного сервиса**:
  ```bash
  make logs s=backend
  ```
- **Выполнение миграций**:
  ```bash
  make migrate
  ```
